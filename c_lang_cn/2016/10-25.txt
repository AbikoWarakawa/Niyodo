00:04 varna joined channel
00:04 varna: 不是我黑爪哇人
00:04 varna: 真的不是黑
00:05 varna: 他们自己写了一个timeout watchdog线程把CPU跑上了200%+还觉得这个架构没问题
00:05 Mokou: ……
00:05 Mokou: 这怎么做到的
00:07 varna: while (mostTimeTrue) { try { InnerTask task = someBlockingQueue.take() /* likely lockless */ ; if (check(task)) { /* abandon task */ } else { someBlockingQueue.put(task) /* less likely lockless */ ; } catch (blah) {} finally {} }
00:07 varna: 这个东西被创建成一个线程的入口函数
00:08 Mokou: ……
00:08 varna: 而这个线程像疯狗一样占掉了可能摸到的CPU
00:08 Mokou: mostTimeTrue带等待么
00:08 varna: 像这样的线程能活跃起来的，有两个
00:08 varna: 不带，是个volatile boolean
00:08 Mokou: ……
00:08 Mokou: 66666666
00:09 Mokou: 强行自旋
00:09 varna: 我花了超过半个小时/人跟两个人解释清楚这个自旋吃掉了CPU时间，导致测试服务器狂转不止
00:09 varna: 但他们拒绝放弃自旋
00:09 Mokou: ……
00:09 varna: 我放弃继续往下提方案了
00:09 Mokou: 好歹写个yield城步
00:09 Mokou: 成不*
00:09 varna: 他们以为服务器都搞这么个东西自旋着
00:10 Mokou: ……
00:10 varna: 然而lighttpd那种不长进的玩意儿也只是定期检查一次
00:10 varna: 更别说09年以后的设计了
00:10 Mokou: 他们的脑子在哪里
00:10 varna: 然后下午还压出了一堆mysql死锁
00:10 Mokou: ……
00:11 varna: 压了不太长的时间，出了大约8.1k个
00:11 varna: 具体来说，事务1锁主键索引、要求某个单列索引；事务2相反
00:11 Mokou: 这东西能用么
00:11 varna: 然后mysql开始回滚
00:11 varna: 能用
00:11 Mokou: ……
00:11 varna: 速度还是不错的，除掉几个龌龊地方
00:11 Mokou: 写个脚本四分钟重启一次？
00:11 varna: 然后我看了看那个神奇的单列索引
00:12 varna: 除了yes和no就是null
00:12 varna: 这索引除了拖慢性能之外有任何用处么……
00:12 Mokou: ……
00:12 varna: 纯粹就是设计者不想上表级锁
00:12 varna: 但他这么搞，按索引上锁之后更新索引列，并发上去就是一个死锁……
00:13 varna: 尤其爪哇国人喜欢同步写数据库
00:13 Mokou: ……
00:14 varna: 性能还可以，目前的qps比我预想要好很多，应该达到业务要求了
00:14 Mokou: 噫吁嚱
00:14 varna: 但架构我不喜欢，应该说总体上受到tomcat那个丁日玩意儿的很大限制
00:14 varna: 疯狗一样的异步，连HS/HA处理都没有
00:14 varna: 一旦遇到超时之类要局部统筹的事情就软了手脚
00:15 Mokou: varna: http://kukuruku.co/hub/nix/capturing-packets-in-linux-at-a-speed-of-millions-of-packets-per-second-without-using-third-party-libraries 今天在微博上看到有人转了这么个东西
00:16 varna: 百万包每秒真的可以做到，不过这个做法感觉太魔法了？
00:17 varna: 现在看起来还是在中断上作文章，不管是用户态轮询还是这个中断绑定
00:17 Mokou: 似乎是
00:17 Mokou: 毕竟不用第三方库
00:17 varna: 但没什么存在感
00:17 varna: 还是DPDK吧
00:18 varna: 显得很莉害
00:18 Mokou: 不过那东西能用在非intel网卡上么
00:18 varna: 不能，不过虚拟网卡可以
00:18 Mokou: 噫
00:19 varna: 支持应该很有限，DPDK首页列了一些
00:19 varna: 玛德今天被爪哇国人的理解力气得有点迷糊
01:00 varna: 洗个澡打打游戏等头发干
01:17 varna: 睡前还可以烧点水冲一碗麦片吃吃
01:17 varna: 等再有闲些，就去买黑芝麻糊
01:17 varna: _(:з」∠)_
01:44 * varna 酱油麦片
01:54 xxxxxxxx joined channel
02:13 varna quit:Quit: leaving
02:17 Mokou: 睡觉
02:17 Mokou: 诸君武运
02:17 Mokou quit:Quit: 睡觉
04:16 xxxxxxxx quit:Quit: Leaving...
05:07 T-J-M quit:Quit: 上课去
07:15 cleamoon joined channel
07:15 cleamooon joined channel
07:20 cleamoooon joined channel
07:21 cleamooon quit:Ping timeout: 260 seconds
07:21 cleamoon quit:Ping timeout: 256 seconds
07:27 T-J-M joined channel
07:34 cleamoon joined channel
07:35 T-J-M quit:Quit: 瓷饭
07:43 fy3 quit:Remote host closed the connection
07:43 Sasasu joined channel
07:43 fy joined channel
07:45 condy quit:*.net *.split
07:45 dantmnf quit:*.net *.split
07:46 condy joined channel
07:46 dantmnf joined channel
07:49 ToaNii quit:Ping timeout: 252 seconds
07:54 ToaNii joined channel
08:22 FrankHB quit:Ping timeout: 250 seconds
08:27 Xilzzerts joined channel
08:34 whocares_2_ joined channel
08:35 whocares_2 quit:Ping timeout: 276 seconds
08:40 xxxxxxxx joined channel
08:43 FrankHB joined channel
08:51 iyzsong-xx joined channel
08:56 xxxxxxxx: http://finance.ifeng.com/a/20161025/14959616_0.shtml 装B实例
09:02 iyzsong-xx: = =
09:08 Xilzzerts quit:Ping timeout: 252 seconds
09:18 lh_mouse joined channel
10:05 Xilzzerts joined channel
10:28 LastAvengers joined channel
11:12 whocares_2_ quit:Ping timeout: 250 seconds
11:12 whocares_2 joined channel
11:57 Mokou joined channel
12:08 LastAvengers quit:Ping timeout: 276 seconds
12:52 iyzsong-xx: -.-
12:55 LastAvengers joined channel
13:14 CyrusYzGTt quit:Quit: 大道無形，生育天地；大道無情，運行日月；大道無名，長養萬物。
13:17 T-J-M joined channel
13:25 StardustX joined channel
13:37 LastAvengers quit:Ping timeout: 256 seconds
13:40 LastAvengers joined channel
14:24 blackskygg joined channel
14:38 blackskygg quit:Remote host closed the connection
14:44 xxxxxxxx quit:Ping timeout: 265 seconds
14:44 xxxxxxxx joined channel
14:45 LastAvengers quit:Ping timeout: 265 seconds
14:47 T-J-M quit:Quit: 重启去了
14:48 T-J-M joined channel
15:21 cleamoooon: http://photo2.fanfou.com/v1/mss_3d027b52ec5a4d589e68050845611e68/ff/n0/0d/70/w2_278966.jpg@596w_1l.jpg
15:28 cleamoooon: http://photo2.fanfou.com/v1/mss_3d027b52ec5a4d589e68050845611e68/ff/n0/0d/70/7j_383453.jpg@596w_1l.jpg  23333
15:33 cleamooon joined channel
15:37 cleamoooon quit:Ping timeout: 260 seconds
15:43 condy quit:Ping timeout: 245 seconds
15:44 condy joined channel
15:51 LastAvengers joined channel
16:31 Xilzzerts quit:Remote host closed the connection
16:31 Xilzzerts joined channel
16:50 oierufdl joined channel
17:22 bestucan joined channel
17:26 oierufdl quit:Ping timeout: 245 seconds
17:33 bestucan quit:Quit: Leaving
17:36 bestucan joined channel
17:39 chaka joined channel
17:43 chaka left channel:"Textual IRC Client: www.textualapp.com"
17:57 lh_not_bot quit:Quit: Lost terminal
18:07 iyzsong-xx quit:Read error: Connection reset by peer
18:12 FrankHB quit:Ping timeout: 244 seconds
18:12 Mokou: geordi: << std::chrono::system_clock::now().time_since_epoch().count()
18:12 geordi: 1477390222712144297
18:43 condy quit:Ping timeout: 245 seconds
18:45 condy joined channel
18:46 iyzsong joined channel
18:47 lh_not_bot joined channel
18:50 iyzsong: _(:з」∠)_
18:51 LastAvengers quit:Quit: Srain0.05-git@0.367.69acfba close.
19:08 cleamooon quit:Ping timeout: 244 seconds
19:12 oierufdl joined channel
19:42 hoxily joined channel
19:56 oierufdl quit:Remote host closed the connection
20:05 yimis joined channel
20:14 whatofor quit:Read error: Connection reset by peer
20:14 whatofor joined channel
20:17 LastAvengers joined channel
20:42 StardustX quit:
20:42 StardustX_ joined channel
20:42 StardustX_ is now known as StardustX
20:52 Sasasu quit:Ping timeout: 250 seconds
21:45 StardustX quit:Remote host closed the connection
21:55 lh_mouse quit:Read error: Connection reset by peer
21:55 lh_mouse joined channel
22:01 yimis quit:Quit: yimis
22:10 Xilzzerts quit:Ping timeout: 252 seconds
22:11 Sasasu joined channel
22:46 lh_mouse quit:Ping timeout: 250 seconds
22:49 lh_mouse joined channel
23:18 yimis joined channel
23:24 lh_mouse quit:Read error: Connection reset by peer
23:26 cleamooon joined channel
23:26 iyzsong quit:Quit: bye.
23:32 Sasasu quit:Quit: WeeChat 1.0.1
